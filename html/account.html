<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Quản lý tài khoản - Cat Cafe</title>
  <link rel="stylesheet" href="../css/style.css">
</head>
<body>
  <header class="site-header elevate-1">
    <nav class="navbar">
      <img src="../images/golocat.jpg" alt="logo" id="cat" />
      <a href="../index.html" class="logo">CÀ PHÊ</a>
      <div class="main-menu">
        <a href="../index.html">Trang Chủ</a>
        <a href="menu.html">Menu</a>
      </div>
      <div class="header-right"></div>
    </nav>
  </header>

  <main style="padding-top:130px;">
    <div class="container">
      <div class="card" style="max-width:640px;margin:40px auto;padding:28px;">
        <h2>Quản lý tài khoản</h2>
        <p class="small">Xem và chỉnh sửa thông tin tài khoản của bạn.</p>

        <div id="account-box" style="margin-top:18px;">
          <div class="form-group">
            <label>Email</label>
            <input id="acc-email" type="email" readonly />
          </div>

          <div class="form-group">
            <label>Họ và tên hiển thị</label>
            <input id="acc-displayName" type="text" />
          </div>

          <div class="form-group">
            <label>Thay đổi mật khẩu (tuỳ chọn)</label>
            <input id="acc-password" type="password" placeholder="Để trống nếu không đổi" />
          </div>

          <div style="display:flex;gap:10px;margin-top:12px;">
            <button id="acc-save" class="btn primary">Lưu thay đổi</button>
            <button id="acc-logout" class="btn secondary">Đăng xuất</button>
          </div>

          <div id="acc-msg" style="margin-top:12px;display:none;" class="success-message"></div>
        </div>
      </div>
    </div>
  </main>

  <script src="../js/main.js"></script>
  <script>
    (function(){
      // wire up account page (depends on main.js helpers)
      function $(s){return document.querySelector(s)}
      const sessionKey = 'coffee_admin_session';
      const profilesKey = 'user_profiles';

      function loadProfiles(){
        return JSON.parse(localStorage.getItem(profilesKey) || '{}');
      }

      function saveProfiles(p){ localStorage.setItem(profilesKey, JSON.stringify(p)); }

      const session = JSON.parse(localStorage.getItem(sessionKey) || 'null');
      if (!session) {
        // redirect to login if no session
        const inHtml = location.pathname.includes('/html/');
        window.location.href = inHtml ? 'login.html' : 'html/login.html';
      } else {
        const profiles = loadProfiles();
        const profile = profiles[session.email] || { displayName: session.displayName || '', password: '' };
        $('#acc-email').value = session.email;
        $('#acc-displayName').value = profile.displayName || session.displayName || '';

        $('#acc-save').addEventListener('click', ()=>{
          const d = $('#acc-displayName').value.trim();
          const pw = $('#acc-password').value;
          const p = loadProfiles();
          p[session.email] = p[session.email] || {};
          if (d) p[session.email].displayName = d;
          if (pw) p[session.email].password = pw; // note: password stored locally only
          saveProfiles(p);
          // also update session displayName so header reflects change immediately
          const s = JSON.parse(localStorage.getItem(sessionKey) || 'null');
          if (s) { s.displayName = p[session.email].displayName || s.displayName; localStorage.setItem(sessionKey, JSON.stringify(s)); }
          if (typeof renderHeaderUser === 'function') renderHeaderUser();
          $('#acc-msg').style.display = 'block';
          $('#acc-msg').textContent = 'Đã lưu thay đổi.';
        });

        $('#acc-logout').addEventListener('click', ()=>{
          if (typeof showLogoutConfirm === 'function') {
            showLogoutConfirm();
          } else {
            localStorage.removeItem(sessionKey); renderHeaderUser(); window.location.href = '../index.html';
          }
        });
      }
    })();
  </script>
</body>
</html>
